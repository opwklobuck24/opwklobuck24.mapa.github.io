<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Szlaku Bitwy pod Mokrą</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <style>
        body { margin: 0; padding: 0; }
        #map-container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 10px; overflow: visible; position: relative; z-index: 10; }
        #map { width: 100%; height: 600px; border: 2px solid #2e5b2e; border-radius: 8px; position: relative; z-index: 10; overflow: visible; }
    </style>
</head>
<body>
    <div id="map-container">
        <div id="map"></div>
    </div>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Ensure Leaflet is loaded
            if (typeof L === 'undefined') {
                console.error('Leaflet library failed to load. Check the network or CDN.');
                return;
            }

            // Ensure map container exists
            var mapContainer = document.getElementById('map');
            if (!mapContainer) {
                console.error('Map container (#map) not found in the DOM.');
                return;
            }

            // Initialize map with fixed zoom and center
            try {
                var map = L.map('map', {
                    center: [50.96, 18.92],
                    zoom: 13,
                    zoomControl: true,
                    minZoom: 10, // Prevent excessive zooming out
                    maxBounds: [[50.8, 18.7], [51.1, 19.1]], // Restrict to the area around Mokra
                    maxBoundsViscosity: 1.0 // Enforce bounds strictly
                });

                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 19
                }).addTo(map);

                // Points for the trail
                var points = [
                    {lat: 50.958865, lng: 18.918025, title: '1. Pomnik'},
                    {lat: 50.959774, lng: 18.915518, title: '2. Kościółek'},
                    {lat: 50.959119, lng: 18.909834, title: '3. Dąb rtm. Hollaka'},
                    {lat: 50.948858, lng: 18.889433, title: '4. I linia obrony'},
                    {lat: 50.958209, lng: 18.926947, title: '5. Walka 2.DAK'},
                    {lat: 50.962619, lng: 18.931671, title: '6. 12.PUł. i PP nr 53. „Śmiały”'},
                    {lat: 50.970341, lng: 18.969325, title: '7. Miedźno - mogiła zbiorowa'},
                    {lat: 50.988265, lng: 18.948499, title: '8. Miejsce śmierci rtm. Jerzego Hollaka'},
                    {lat: 50.986457, lng: 18.937162, title: '9. Szarża 19.P.Uł'},
                    {lat: 50.96189966561543, lng: 18.91426577837677, title: '10. Muzeum w Mokrej'}
                ];

                // Add markers
                points.forEach(function(p) {
                    L.marker([p.lat, p.lng]).addTo(map).bindPopup('<b>' + p.title + '</b>');
                });

                // Add polyline (red line) for points 1-9 only
                var latlngs = points.slice(0, 9).map(p => [p.lat, p.lng]);
                var polyline = L.polyline(latlngs, {color: 'red', weight: 4, opacity: 0.7}).addTo(map);

                // Fit map to polyline bounds
                map.fitBounds(polyline.getBounds());

                // Robust redraw with retry
                function redrawMap() {
                    map.invalidateSize();
                    map.fitBounds(polyline.getBounds());
                }
                setTimeout(redrawMap, 100);
                setTimeout(redrawMap, 500); // Retry after 500ms to handle iframe delays
                setTimeout(redrawMap, 1000); // Retry again for safety
            } catch (error) {
                console.error('Error initializing Leaflet map:', error);
            }
        });
    </script>
</body>
</html>
